---
- name: Machine setup
  hosts: localhost
  become: true
  connection: local
  gather_facts: true
  vars:
    flyctl_version: "0.1.130"
    pulumi_version: "v3.94.2"

  tasks:
    - name: Get Distribution
      shell: uname
      ignore_errors: yes
      register: uname 

    - name: Get my user
      ansible.builtin.set_fact:
        remote_regular_user: "{{ ansible_env.SUDO_USER if ansible_env.SUDO_USER is defined else ansible_user_id }}"

    - name: Install packages
      ansible.builtin.apt:
        name:
          - locales
          - git
          - vim
          - zsh
        state: present

    - name: Change shell to zsh
      ansible.builtin.user:
        name: "{{ remote_regular_user }}"
        shell: /usr/bin/zsh

    - name: Generate Locales
      ansible.builtin.shell:
        cmd: locale-gen en_US.UTF-8

    - name: Update Homebrew
      community.general.homebrew:
        update_homebrew: true

    - name: Install Brew Packages
      community.general.homebrew:
        name:
          - exa
          - fzf
          - autoenv
          - pyenv
          - plenv
        state: present

    - name: Font base install path
      set_fact:
          font_base_path: "{% if uname.stdout == 'Darwin' %}~/Library/Fonts{% else %}/usr/share/fonts{% endif %}" 
     
    - name: Creating InconsolataGo font directory
      file:
        path: "{{ font_base_path }}/InconsolataGo"
        state: directory
    

    - name: Installing InconsolataGo Font
      ansible.builtin.get_url:
        url: "{{ item }}"
        dest: "{{ font_base_path }}/InconsolataGo"
        mode: "0644"
      loop:
        - https://github.com/ryanoasis/nerd-fonts/raw/HEAD/patched-fonts/InconsolataGo/Regular/InconsolataGoNerdFont-Regular.ttf
        - https://github.com/ryanoasis/nerd-fonts/raw/HEAD/patched-fonts/InconsolataGo/Regular/InconsolataGoNerdFontMono-Regular.ttf
        - https://github.com/ryanoasis/nerd-fonts/raw/HEAD/patched-fonts/InconsolataGo/Regular/InconsolataGoNerdFontPropo-Regular.ttf
        - https://github.com/ryanoasis/nerd-fonts/raw/HEAD/patched-fonts/InconsolataGo/Bold/InconsolataGoNerdFont-Bold.ttf
        - https://github.com/ryanoasis/nerd-fonts/raw/HEAD/patched-fonts/InconsolataGo/Bold/InconsolataGoNerdFontMono-Bold.ttf
        - https://github.com/ryanoasis/nerd-fonts/raw/HEAD/patched-fonts/InconsolataGo/Bold/InconsolataGoNerdFontPropo-Bold.ttf
      
